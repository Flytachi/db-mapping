<?php

declare(strict_types=1);

namespace Flytachi\DbMapping\Attributes\Hybrid;

use Attribute;
use Flytachi\DbMapping\Attributes\Additive\NullableIs;
use Flytachi\DbMapping\Attributes\Idx\Primary;
use Flytachi\DbMapping\Attributes\Primal\Integer;
use Flytachi\DbMapping\Attributes\Sub\AutoIncrement;

#[Attribute(Attribute::TARGET_PROPERTY)]
readonly class Id implements AttributeDbHybrid
{
    /**
     * AutoIncrement attribute for marking a property as an auto-incrementing column.
     *
     * @param bool $always
     *     If true, uses `GENERATED ALWAYS AS IDENTITY` for Postgres.
     *     If false (default), uses `GENERATED BY DEFAULT AS IDENTITY` for Postgres.
     *     Has no effect for MySQL (always uses AUTO_INCREMENT).
     */
    public function __construct(
        private bool $always = false
    ) {
    }

    public function getInstances(string $dialect = 'mysql'): array
    {
        return [
            new Primary(),
            new AutoIncrement($this->always),
            new NullableIs(false),
            new Integer()
        ];
    }
}
